<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Proving Grounds - Photographer · Hacking Things
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Eduardo Borges">
<meta name="description" content="Introdução Link to heading Iniciando a série de postagens sobre desafios/CTFs realizados, decidi por documentar a máquina Photographer (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar &ldquo;flags&rdquo; (bandeiras), que são evidências de que conseguiram comprometer com sucesso os alvos designados.">
<meta name="keywords" content="blog,developer,personal">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Proving Grounds - Photographer">
  <meta name="twitter:description" content="Introdução Link to heading Iniciando a série de postagens sobre desafios/CTFs realizados, decidi por documentar a máquina Photographer (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar “flags” (bandeiras), que são evidências de que conseguiram comprometer com sucesso os alvos designados.">

<meta property="og:url" content="http://localhost:1313/posts/proving-grounds/photographer/">
  <meta property="og:site_name" content="Hacking Things">
  <meta property="og:title" content="Proving Grounds - Photographer">
  <meta property="og:description" content="Introdução Link to heading Iniciando a série de postagens sobre desafios/CTFs realizados, decidi por documentar a máquina Photographer (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar “flags” (bandeiras), que são evidências de que conseguiram comprometer com sucesso os alvos designados.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-15T09:00:08-03:00">
    <meta property="article:modified_time" content="2024-04-15T09:00:08-03:00">
    <meta property="article:tag" content="Writeups">
    <meta property="article:tag" content="Proving-Grounds">




<link rel="canonical" href="http://localhost:1313/posts/proving-grounds/photographer/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Hacking Things
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">Sobre</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/proving-grounds/photographer/">
              Proving Grounds - Photographer
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-04-15T09:00:08-03:00">
                April 15, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              7-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/eduardo-borges/">Eduardo Borges</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/writeups/">Writeups</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/proving-grounds/">Proving-Grounds</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="introdução">
  Introdução
  <a class="heading-link" href="#introdu%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Iniciando a série de postagens sobre desafios/CTFs realizados, decidi por documentar a máquina Photographer (nível Fácil/Easy), disponível gratuitamente no <a href="https://portal.offsec.com/labs/play"  class="external-link" target="_blank" rel="noopener">Proving Grounds Play</a>.</p>
<p>Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar &ldquo;flags&rdquo; (bandeiras), que são evidências de que conseguiram comprometer com sucesso os alvos designados.</p>
<p>O desafio <strong>Photographer</strong> demanda um comprometimento inicial, onde o atacante deve adquirir a flag de usuário, e posteriormente escalonar privilégios (privilege escalation), adquirindo a flag de root.</p>
<h2 id="enumeração">
  Enumeração
  <a class="heading-link" href="#enumera%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Para iniciar o processo de enumeração, realizei um scan de portas via <a href="https://nmap.org/"  class="external-link" target="_blank" rel="noopener">nmap</a> junto ao IP disponibilizado.</p>
<p><strong>Comando utilizado:</strong> <code>nmap -sV -p- --min-rate 10000 192.168.245.76</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-sV</strong> permite a identificação dos serviços/versões rodando nas portas que forem identificadas como abertas (open);</li>
<li><strong>-p-</strong> permite a definição de todas as 65.535 portas do protocolo TCP para scanning;</li>
<li><strong>--min-rate 10000</strong> informa ao nmap para tentar enviar no minimo 10000 pacotes por segundo, como uma tentativa de acelerar a análise (pode comprometer a precisão dos resultados dependendo da rede).</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem1.png#center" alt="">
Visando facilitar o processo de análise e exploração, adicionei o IP 192.168.245.76 no arquivo /etc/hosts da máquina de atacante, atribuindo o nome <strong>photographer.pg</strong> ao IP.</p>
<p>Na sequência, enumerei o serviço SMB disponível (nas portas 139 e 445) utilizando o <a href="https://www.samba.org/samba/docs/4.9/man-html/smbclient.1.html"  class="external-link" target="_blank" rel="noopener">smbclient</a>.</p>
<p><strong>Comando utilizado:</strong> <code>smbclient -L \\\\photographer.pg -N</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-L</strong> permite a listagem de serviços disponíveis no servidor;</li>
<li><strong>-N</strong> suprime a requisição de senha ao usuário.</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem2.png#center" alt=""></p>
<p>Na sequência efetuei a conexão no share <strong>sambashare</strong> utilizando credenciais nulas (null credentials).</p>
<p><strong>Comando utilizado:</strong> <code>smbclient \\\\photographer.pg\\sambashare -N</code></p>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem3.png#center" alt=""></p>
<p>Como resultado, foi possível identificar os arquivos <strong>mailsent.txt</strong> e <strong>wordpress.bkp.zip</strong>.</p>
<p>Após baixar o arquivo <strong>mailsent.txt</strong> e analisar seu conteúdo, foi possível identificar um usuário chamado <strong>Daisa</strong> e o e-mail <strong><a href="mailto:daisa@photographer.com" >daisa@photographer.com</a></strong>:</p>
<p><img src="/pg-photographer/imagem3.1.png#center" alt=""></p>
<p>O arquivo zipado <strong>wordpress.bkp.zip</strong> continha apenas uma instalação default de Wordpress, sem informações sensíveis.</p>
<p>Na sequência efetuei a enumeração do servidor web (webserver) rodando na porta <strong>80</strong> através da ferramenta <a href="https://github.com/maurosoria/dirsearch"  class="external-link" target="_blank" rel="noopener">dirsearch</a>.</p>
<p><strong>Comando utilizado:</strong> <code>dirsearch -w /usr/share/wordlists/dirb/big.txt -x 404 -u http://photographer.pg</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-w</strong> permite a informação de uma wordlist a ser utilizada para o processo de ataque de dicionário;</li>
<li><strong>-x</strong> exclui um status code da análise, este caso o 404;</li>
<li><strong>-u</strong>  permite a informação da URL a ser analisada.</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem4.png#center" alt=""></p>
<p>O resultado não trouxe informações interessantes que indiquem um caminho a ser utilizado para acesso inicial.</p>
<p>Ao acessar o webserver na porta <strong>80</strong> foi possível identificar a seguinte tela:</p>
<p><img src="/pg-photographer/imagem5.png#center" alt=""></p>
<p>Dando continuidade ao processo de análise, efetuei a enumeração do webserver rodando na porta <strong>8000</strong>.</p>
<p><strong>Comando utilizado:</strong> <code>dirsearch -w /usr/share/wordlists/dirb/big.txt -x 404 -u http://photographer.pg:8000</code></p>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem6.png#center" alt=""></p>
<p>A ideia de filtrar apenas o código de erro 404 visa permitir a visualização páginas/arquivos com redirecionamentos (301, 302), autenticações (401) ou proibição de acesso (403).</p>
<p>Ao acessar o endereço <a href="http://photographer.pg:8000/admin/"  class="external-link" target="_blank" rel="noopener">http://photographer.pg:8000/admin/</a> o usuário é direcionado a um painel administivo:</p>
<p><img src="/pg-photographer/imagem7.png#center" alt=""></p>
<h2 id="exploração-e-acesso-incial">
  Exploração e acesso incial
  <a class="heading-link" href="#explora%c3%a7%c3%a3o-e-acesso-incial">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Inicialmente testei o processo de autenticação com dados randômicos, monitorando as requisições através do <a href="https://portswigger.net/burp/communitydownload"  class="external-link" target="_blank" rel="noopener">Burp Suite</a>, com o objetivo de identificar os parâmetros da requisição (request) e resposta (response):</p>
<p><img src="/pg-photographer/imagem8.png#center" alt=""></p>
<p>Como resultado foi possível identificar que a requisição faz uma chamada ao endereço <strong>/api.php?/sessions</strong>, passando os parâmetros <strong>email</strong> e <strong>password</strong>. Caso o usuário não exista, o response retorna em formato json a mensagem <strong>User not found.</strong> No caso da senha estar errada, o retorno de erro é: <strong>Incorrect. Try again or reset your password.</strong></p>
<p>Como na fase de enumeração foi identificado o e-mail <strong><a href="mailto:daisa@photographer.com" >daisa@photographer.com</a></strong>, preparei um ataque de força bruta (brute force) através da ferramenta <strong>hydra</strong>, passando como referência o e-mail, os parâmetros e retorno de erro:</p>
<p><strong>Comando utilizado:</strong> <code>hydra -l daisa@photographer.com -P /usr/share/wordlists/rockyou.txt 192.168.245.76 -s 8000 http-post-form &quot;/api.php?/sessions:email=^USER^&amp;password=^PASS^:Incorrect. Try again or reset your password.&quot; -vv -I</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-l</strong> permite a informação de um nome de usuário;</li>
<li><strong>-P</strong> permite a informação de uma wordlist de senhas;</li>
<li><strong>-s</strong> permite a informação da porta do alvo para o caso de serviços que não rodam em sua porta padrão;</li>
<li><strong>http-post-form</strong> serviço a ser testado, nesse caso um formulário web utilizando o método POST;</li>
<li><strong>-vv</strong> aumenta a verbosidade dos resultados apresentados em tela;</li>
<li><strong>-I</strong> ignora a existência de um arquivo de restauração do hydra.</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem9.png#center" alt=""></p>
<p>A ferramenta <a href="https://github.com/vanhauser-thc/thc-hydra"  class="external-link" target="_blank" rel="noopener">THC Hydra</a> identificou que um conjunto de credenciais permitem a autenticação na plataforma. Ao utilizar as credenciais obtidas, foi possível acessar a plataforma de administração do CMS <strong>Koken CMS</strong>:</p>
<p><img src="/pg-photographer/imagem10.png#center" alt=""></p>
<p>Após utilizar a plataforma por alguns minutos, procurei por um exploit para o CMS, onde identifiquei a seguinte referência de uma falha que permite upload arbitrário de arquivos (autenticado): <a href="https://www.exploit-db.com/exploits/48706"  class="external-link" target="_blank" rel="noopener">Exploit-DB - Arbitrary File Upload (Authenticated)</a></p>
<p>A referência indica que o CMS permite o upload irrestrito de arquivos a partir da manipulação da requisição, onde posteriormente, através da identificação do diretório do webserver onde o arquivo foi inserido, o atacante pode acessar esse arquivo e executar sua webshell/shell reversa.</p>
<p>Na sequência criei uma backdoor em php e dei o nome de <strong>image.php.jpg</strong>:</p>
<p><img src="/pg-photographer/imagem11.png#center" alt=""></p>
<p>Efetuei o upload do arquivo através do botão <strong>Import content</strong> (canto inferior direito) no menu <strong>Library panel</strong>:</p>
<p><img src="/pg-photographer/imagem12.png#center" alt=""></p>
<p>Através da interceptação da requisição via <strong>burpsuite</strong>, editei o conteúdo do parâmetro <strong>name</strong> (linha 18) e o conteúdo do parâmetro <strong>filename</strong> (linha 44), mudando ambos para <strong>image.php</strong>:</p>
<p><img src="/pg-photographer/imagem13.png#center" alt=""></p>
<p>Após essa alteração, selecionei o arquivo enviado ao servidor e no menu <strong>Inspector</strong> (lateral direita), cliquei com o botão direito do mouse na opção <strong>Download File</strong> e copiei o link do arquivo:</p>
<p><img src="/pg-photographer/imagem14.png#center" alt=""></p>
<p>Ao acessar o endereço <a href="http://photographer.pg:8000/storage/originals/d2/bf/image.php?cmd=whoami"  class="external-link" target="_blank" rel="noopener">http://photographer.pg:8000/storage/originals/d2/bf/image.php?cmd=whoami</a> foi possível confirmar a execução arbitrária de código (Remote Code Execution - RCE) através da webshell enviada ao servidor:</p>
<p><img src="/pg-photographer/imagem15.png#center" alt=""></p>
<p>Na sequência preparei um listener de netcat, onde através da ferramenta online <a href="https://www.revshells.com/"  class="external-link" target="_blank" rel="noopener">Reverse Shell Generator</a> gerei uma shell reversa do tipo <strong>nc mkfifo</strong> encodada como <strong>URL encode</strong>, passando o resultado como parâmetro via navegador.</p>
<p><img src="/pg-photographer/imagem16.png#center" alt=""></p>
<p>Esse processo de encoding é necessário para que o comando seja executado corretamente, uma vez que ele possui caracteres especiais que podem ser interpretados de forma não desejada pelo webserver ou pelo navegador.</p>
<p><strong>Resultado da execução do comando, pegando uma shell como www-data:</strong></p>
<p><img src="/pg-photographer/imagem17.png#center" alt=""></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>rlwrap</strong> <a href="https://github.com/hanslub42/rlwrap"  class="external-link" target="_blank" rel="noopener">Ferramenta</a> utilizada em conjunto ao netcat para fornecer uma shell mais estável;</li>
<li><strong>-lnvp</strong> (l) modo de escuta para conexões de entrada, (n) desabilita a resolução de DNS, (v) adiciona mais verbosidade ao comando, (p) permite a indicação da porta de escuta da ferramenta.</li>
</ul>
<p>Dentro do diretório <strong>/home/daisa</strong> foi possível localizar o arquivo <strong>local.txt</strong>, contendo a flag de usuário:</p>
<p><img src="/pg-photographer/imagem18.png#center" alt=""></p>
<h2 id="escalonamento-de-privilégios">
  Escalonamento de Privilégios
  <a class="heading-link" href="#escalonamento-de-privil%c3%a9gios">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Iniciando a análise de vetores de escalonamento de privilégios (privilege escalation), listei os usuários que possuem terminal ativo:</p>
<p><strong>Comando utilizado:</strong> <code>cat /etc/passwd | grep &quot;/bin/bash&quot;</code></p>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem19.png#center" alt=""></p>
<p>Na sequência fiz a análise de binários que possuem o SUID bit setado. Referência sobre <a href="https://reddyyz.github.io/blog/suid-privilege-escalation"  class="external-link" target="_blank" rel="noopener">SUID Privilege Escalation</a>.</p>
<p><strong>Comando utilizado:</strong> <code>find / -type f -perm -04000 -ls 2&gt;/dev/null</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>/</strong> indica a pesquisa a partir da raiz do sistema;</li>
<li><strong>-type f</strong> permite a pesquisa considerando apenas arquivos normais;</li>
<li><strong>-perm -04000</strong> utilizado para filtrar arquivos com a permissão 04000, ou seja, que possuem o bit SUID setado;</li>
<li><strong>-ls</strong> permite a listagem detalhada das informações obtidas a partir do find;</li>
<li><strong>2&gt;/dev/null</strong> permite o redirecionamento das mensagens de erro para /dev/null, removendo possíveis erros da tela.</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem20.png#center" alt=""></p>
<p>No resultado acima, o binário do PHP em <strong>/usr/bin/php7.2</strong> chamou a atenção por não ser um binário que comumente tem esse tipo de permissão. Através do site <a href="https://gtfobins.github.io/gtfobins/php/"  class="external-link" target="_blank" rel="noopener">GTFOBins</a> foi possível identificar como explorar a permissão de SUID para escalonar privilégios.</p>
<p><strong>Comando utilizado:</strong> <code>/usr/bin/php7.2 -r &quot;pcntl_exec('/bin/sh',['-p']);&quot;</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-r</strong> permite a execução de código PHP através da linha de comando;</li>
<li><strong>pcntl_exec()</strong> é uma <a href="https://www.php.net/manual/pt_BR/function.pcntl-exec.php"  class="external-link" target="_blank" rel="noopener">função PHP</a> que permite executar o programa especificado na função substituindo o processo que chamou a própria função;</li>
<li><strong>/bin/sh</strong> programa que será executado para substituir o processo PHP;</li>
<li><strong>-p</strong> parâmetro utilizado para iniciar uma shell protegida/privilegiada.</li>
</ul>
<p><strong>Resultado:</strong>
<img src="/pg-photographer/imagem21.png#center" alt=""></p>
<p>Como resultado foi possível escalonar privilégios para o usuário <strong>root</strong>.</p>
<p>Dentro do diretório <strong>/root</strong> foi possível localizar o arquivo <strong>proof.txt</strong> contendo a flag final (root) do desafio:</p>
<p><img src="/pg-photographer/imagem22.png#center" alt=""></p>
<h2 id="conclusão">
  Conclusão
  <a class="heading-link" href="#conclus%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><strong>Photographer</strong> foi um desafio bem interessante de ser realizado, possuindo um caminho bem definido tanto para exploração inicial quanto para escalonamento de privilégios.
Notei depois do bruteforce com hydra que a senha da conta identificada também estava disponível no arquivo <strong>mailsent.txt</strong>, reforçando a importância de uma enumeração minuciosa, onde devemos analisar/compreender as descobertas de cada etapa do processo de Pentest.</p>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Eduardo Borges 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
