<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Proving Grounds - Shakabrah · Hacking Things
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Eduardo Borges">
<meta name="description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios/CTFs realizados, trago a documentação da máquina Shakabrah (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">
<meta name="keywords" content="blog,developer,personal">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Proving Grounds - Shakabrah">
  <meta name="twitter:description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios/CTFs realizados, trago a documentação da máquina Shakabrah (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">

<meta property="og:url" content="http://localhost:1313/posts/proving-grounds/shakabrah/">
  <meta property="og:site_name" content="Hacking Things">
  <meta property="og:title" content="Proving Grounds - Shakabrah">
  <meta property="og:description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios/CTFs realizados, trago a documentação da máquina Shakabrah (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-11T10:05:08-03:00">
    <meta property="article:modified_time" content="2024-11-11T10:05:08-03:00">
    <meta property="article:tag" content="Writeups">
    <meta property="article:tag" content="Proving-Grounds">




<link rel="canonical" href="http://localhost:1313/posts/proving-grounds/shakabrah/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Hacking Things
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">Sobre</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/proving-grounds/shakabrah/">
              Proving Grounds - Shakabrah
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-11-11T10:05:08-03:00">
                November 11, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/eduardo-borges/">Eduardo Borges</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/writeups/">Writeups</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/proving-grounds/">Proving-Grounds</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="introdução">
  Introdução
  <a class="heading-link" href="#introdu%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Dando continuidade à série de postagens sobre desafios/CTFs realizados, trago a documentação da máquina Shakabrah (nível Fácil/Easy), disponível gratuitamente no <a href="https://portal.offsec.com/labs/play"  class="external-link" target="_blank" rel="noopener">Proving Grounds Play</a>.</p>
<p>Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.</p>
<h2 id="enumeração">
  Enumeração
  <a class="heading-link" href="#enumera%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Para iniciar o processo de enumeração, realizei um scan de portas via <a href="https://nmap.org/"  class="external-link" target="_blank" rel="noopener">nmap</a> junto ao IP disponibilizado.</p>
<p><strong>Comando:</strong> <code>nmap -sV -p- --min-rate 10000 192.168.245.86</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-sV</strong> permite a identificação dos serviços/versões rodando nas portas que forem identificadas como abertas (open);</li>
<li><strong>-p-</strong> permite o scan de todas as 65.535 portas TCP;</li>
<li><strong>--min-rate 10000</strong> informa ao nmap para tentar enviar no mínimo 10000 pacotes por segundo, como uma tentativa de acelerar a análise (pode impactar a precisão dos resultados).</li>
</ul>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem1.png" alt="Resultado da execução do nmap" class="centered-image" />
</div>

<p>O scan com nmap retornou um servidor web na porta 80 e um servidor SSH na porta 22. Visando facilitar o processo de análise e exploração, adicionei o IP 192.168.245.86 no arquivo /etc/hosts da máquina de atacante, atribuindo o nome <strong>shakabrah.pg</strong> ao IP.</p>
<p>Na sequência, enumerei o webserver através da ferramenta <a href="https://github.com/maurosoria/dirsearch"  class="external-link" target="_blank" rel="noopener">dirsearch</a>, utilizando a wordlist padrão da ferramenta <a href="https://www.kali.org/tools/dirb/"  class="external-link" target="_blank" rel="noopener">dirb</a> big.txt.</p>
<p><strong>Comando:</strong> <code>dirsearch -w /usr/share/wordlists/dirb/big.txt -x 404 -u http://shakabrah.pg</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-w</strong> permite a informação de uma wordlist a ser utilizada para o processo de ataque de dicionário;</li>
<li><strong>-x 404</strong> exclui o status code <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404"  class="external-link" target="_blank" rel="noopener">404</a>, o que facilita a análise do output do comando;</li>
<li><strong>-u</strong>  permite a informação da URL a ser analisada.</li>
</ul>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem2.png" alt="Resultado da execução do dirsearch" class="centered-image" />
</div>

<p>Como o resultado do dirsearch não trouxe arquivos/diretórios a serem verificados, acessei a página através do navegador:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem3.png" alt="Acesso inicial ao webserver via navegador" class="centered-image" />
</div>

<p>De acordo com o título, trata-se de uma ferramenta para testar a conexão a partir do comando Ping. Ao informar o IP 127.0.0.1 (localhost) e clicar no botão <strong>Go</strong>, o usuário visualiza o resultado do comando em tela. Também é possível observar que a resposta (response) adiciona o parâmetro <!-- raw HTML omitted -->host<!-- raw HTML omitted --> na URL do site, indicando que a requisição foi feita através do método GET:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem4.png" alt="Teste da ferramenta" class="centered-image" />
</div>

<p>Ao analisar este comportamento, interpretei que os dados informados no input são repassados a uma função que realiza um ping junto à máquina, o que se não for sanitizado corretamente, pode servir como vetor para execução remota de código (Remote Code Execution - RCE).</p>
<p>Para confirmar essa hipótese, adicionei a string <strong>;ls</strong> ao final do IP 127.0.0.1, listando o conteúdo do diretório em que a página se encontra:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem5.png" alt="Verificação da existência de RCE" class="centered-image" />
</div>

<p>Em seguida, li o arquivo <strong>/etc/passwd</strong>, passando a string <strong>;cat /etc/passwd</strong> como parâmetro:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem6.png" alt="Leitura do arquivo /etc/passwd" class="centered-image" />
</div>

<p>Também testei a possibilidade de utilizar o comando <a href="https://www.guiafoca.org/guiaonline/iniciante/ch12s05.html"  class="external-link" target="_blank" rel="noopener">pipe</a> para mostrar apenas o output do segundo comando, tendo sucesso na verificação da existência do binário <strong>nc</strong> no alvo, passando a string <strong>|whereis nc</strong>.</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem7.png" alt="Verificação da existência do binário nc" class="centered-image" />
</div>

<h2 id="exploração-e-acesso-inicial">
  Exploração e acesso inicial
  <a class="heading-link" href="#explora%c3%a7%c3%a3o-e-acesso-inicial">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Para preparar a máquina para uma conexão reversa, criei um listener com <a href="https://www.kali.org/tools/netcat/"  class="external-link" target="_blank" rel="noopener">netcat</a> através da ferramenta online <a href="https://www.revshells.com/"  class="external-link" target="_blank" rel="noopener">Reverse Shell Generator</a>, selecionando uma reverse shell do tipo <strong>nc mkfifo</strong> codificada como <strong>URL encode</strong>.</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem8.png" alt="Geração da reverse shell" class="centered-image" />
</div>

<p>Por fim, passei a shell como parâmetro da URL via navegador, obtendo uma conexão reversa na máquina do atacante:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem9.png" alt="Obtenção da conexão reversa" class="centered-image" />
</div>

<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>rlwrap</strong> <a href="https://github.com/hanslub42/rlwrap"  class="external-link" target="_blank" rel="noopener">Ferramenta</a> utilizada em conjunto ao netcat para fornecer uma shell mais estável, dando suporte a edição de linha e histórico de comandos;</li>
<li><strong>-lnvp</strong> (l) modo de escuta para conexões de entrada, (n) desabilita a resolução de DNS, (v) adiciona mais verbosidade ao comando, (p) permite a indicação da porta de escuta da ferramenta.</li>
</ul>
<p>Uma vez com acesso à máquina, iniciei o processo de análise manual do sistema de arquivos em busca de artefatos que possam contribuir com a minha exploração.</p>
<p>Dentro do diretório <strong>/home/dylan</strong> foi possível localizar o arquivo <strong>local.txt</strong>, contendo a flag de usuário:</p>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem10.png" alt="Visualização do diretório /home/dylan e flag de usuário" class="centered-image" />
</div>

<h2 id="escalonamento-de-privilégios">
  Escalonamento de Privilégios
  <a class="heading-link" href="#escalonamento-de-privil%c3%a9gios">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Iniciando a análise de vetores de escalonamento de privilégios, analisei os binários que possuem o <a href="https://www.redhat.com/en/blog/suid-sgid-sticky-bit"  class="external-link" target="_blank" rel="noopener">SUID bit</a> setado.</p>
<p><strong>Comando:</strong> <code>find / -type f -perm -04000 -ls 2&gt;/dev/null</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>/</strong> indica a pesquisa a partir da raiz do sistema;</li>
<li><strong>-type f</strong> permite a pesquisa considerando apenas arquivos normais;</li>
<li><strong>-perm -04000</strong> utilizado para filtrar arquivos com a permissão 04000, ou seja, que possuem o bit SUID setado;</li>
<li><strong>-ls</strong> permite a listagem detalhada das informações obtidas do comando find;</li>
<li><strong>2&gt;/dev/null</strong> permite o redirecionamento das mensagens de erro para /dev/null, removendo possíveis erros da tela.</li>
</ul>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem11.png" alt="Visualização de binários com o SUID bit setado" class="centered-image" />
</div>

<p>Como resultado foi possível identificar o binário <strong>/usr/bin/vim.basic</strong> como sendo divergente do padrão de SUID que normalmente encontramos no Linux:</p>
<p>Ao pesquisar sobre o VIM junto ao <a href="https://gtfobins.github.io/gtfobins/vim/"  class="external-link" target="_blank" rel="noopener">GTFOBins</a>, um repositório interessante de binários que possuem vetores para escalonamento de privilégios, foi possível identificar um vetor a partir da exploração do binário com SUID setado.</p>
<p><strong>Comando:</strong> <code>/usr/bin/vim.basic -c ':py3 import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-pc&quot;, &quot;reset; exec sh -p&quot;)'</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-c</strong> permite a execução de um comando no Vim assim que o mesmo for iniciado;</li>
<li><strong>:py3</strong> informa ao Vim para executar um comando Python 3;</li>
<li><strong>import os</strong> importa o módulo <strong>os</strong> do Python;</li>
<li><strong>os.execl()</strong> função usada para executar um novo programa a partir da substituição do processo atual por um novo;</li>
<li><strong>/bin/sh</strong> caminho para o programa a ser executado pelo Python;</li>
<li><strong>sh</strong> nome que será dado ao processo gerado;</li>
<li><strong>-pc</strong> (p) parâmetro utilizado para iniciar uma shell protegida/privilegiada, (c) parâmetro que permite que o shell execute o comando passado na sequência;</li>
<li><strong>reset</strong> efetua a limpeza e restauração da tela do terminal;</li>
<li><strong>exec sh -p</strong> o comando exec altera o processo atual para o shell (sh), complementado pelo parâmetro -p que mantém os privilégios do ambiente.</li>
</ul>
<div style="text-align: center;">
  <img src="/pg-shakabrah/imagem12.png" alt="Resultado do escalonamento de privilégios e visualização da flag de root" class="centered-image" />
</div>

<p>Como resultado, comando acessa o VIM e disponibiliza uma shell com privilégios de root. Dentro do diretório <strong>/root</strong> foi possível localizar o arquivo <strong>proof.txt</strong>, contendo a flag de root.</p>
<h2 id="conclusão">
  Conclusão
  <a class="heading-link" href="#conclus%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>O desafio <strong>shakabrah</strong> foi relativamente simples, onde destaco dois pontos de atenção:</p>
<ul>
<li>É importante gerar o comando de reverse shell encodado para garantir a interpretação de caracteres especiais;</li>
<li>Como boa prática, sempre que realizo o acesso inicial a uma máquina, valido os binários com SUID bit setado pois isso pode garantir o famoso &ldquo;ganho rápido&rdquo; (quick win). Esse tutorial do <a href="https://juggernaut-sec.com/suid-sgid-part-2-lpe/"  class="external-link" target="_blank" rel="noopener">Juggernaut Pentesting Academy</a> traz várias formas de abusar de SUID.</li>
</ul>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Eduardo Borges 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
