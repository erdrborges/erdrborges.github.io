<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Proving Grounds - SunsetDecoy · Hacking Things
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Eduardo Borges">
<meta name="description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios realizados, trago a documentação da máquina SunsetDecoy (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">
<meta name="keywords" content="blog,developer,personal">
<meta name="fediverse:creator" content="" />


  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Proving Grounds - SunsetDecoy">
  <meta name="twitter:description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios realizados, trago a documentação da máquina SunsetDecoy (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">

<meta property="og:url" content="https://erdrborges.github.io/posts/proving-grounds/sunsetdecoy/">
  <meta property="og:site_name" content="Hacking Things">
  <meta property="og:title" content="Proving Grounds - SunsetDecoy">
  <meta property="og:description" content="Introdução Link to heading Dando continuidade à série de postagens sobre desafios realizados, trago a documentação da máquina SunsetDecoy (nível Fácil/Easy), disponível gratuitamente no Proving Grounds Play.
Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-11-19T11:00:08-03:00">
    <meta property="article:modified_time" content="2024-11-19T11:00:08-03:00">
    <meta property="article:tag" content="Writeups">
    <meta property="article:tag" content="Proving-Grounds">




<link rel="canonical" href="https://erdrborges.github.io/posts/proving-grounds/sunsetdecoy/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.07092c1350ffd254998dc43a44ae96e617d14af4df4602626878df89189c5e1a.css" integrity="sha256-BwksE1D/0lSZjcQ6RK6W5hfRSvTfRgJiaHjfiRicXho=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/img/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="https://erdrborges.github.io/">
      Hacking Things
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">Sobre</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://erdrborges.github.io/posts/proving-grounds/sunsetdecoy/">
              Proving Grounds - SunsetDecoy
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-11-19T11:00:08-03:00">
                November 19, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          <div class="authors">
  <i class="fa-solid fa-user" aria-hidden="true"></i>
    <a href="/authors/eduardo-borges/">Eduardo Borges</a></div>

          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/writeups/">Writeups</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/proving-grounds/">Proving-Grounds</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h2 id="introdução">
  Introdução
  <a class="heading-link" href="#introdu%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Dando continuidade à série de postagens sobre desafios realizados, trago a documentação da máquina SunsetDecoy (nível Fácil/Easy), disponível gratuitamente no <a href="https://portal.offsec.com/labs/play"  class="external-link" target="_blank" rel="noopener">Proving Grounds Play</a>.</p>
<p>Para quem não está familiarizado, os desafios do tipo Capture The Flag (CTF) envolvem máquinas vulneráveis que têm como objetivo testar as habilidades dos participantes em identificar e explorar essas falhas. Os competidores devem encontrar flags (bandeiras), que são provas de que conseguiram comprometer com sucesso os alvos designados.</p>
<h2 id="enumeração">
  Enumeração
  <a class="heading-link" href="#enumera%c3%a7%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Para iniciar o processo de enumeração, realizei uma varredura de portas via <a href="https://nmap.org/"  class="external-link" target="_blank" rel="noopener">nmap</a> junto ao IP disponibilizado.</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem1.png" alt="Resultado da execução do nmap" class="centered-image" />
</div>

<p><strong>Comando:</strong> <code>nmap -sV -p- --min-rate 10000 192.168.177.85</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-sV</strong> permite a identificação dos serviços/versões que estão rodando nas portas que forem identificadas como abertas (open);</li>
<li><strong>-p-</strong> permite o scan de todas as 65.535 portas TCP;</li>
<li><strong>--min-rate 10000</strong> informa ao nmap para tentar enviar no mínimo 10000 pacotes por segundo, como uma tentativa de acelerar a análise (pode impactar a precisão dos resultados).</li>
</ul>
<p>A varredura com nmap retornou um servidor web na porta 80 e um servidor SSH na porta 22. Ao acessar o servidor web via navegador, foi possível identificar que não existe um arquivo index.php ou index.html, visto que a página mostrou seu índice (Index of):</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem2.png" alt="Visualização ao acessar o webserver via navegador" class="centered-image" />
</div>

<p>Também foi possível identificar a existência do arquivo <strong>save.zip</strong>. Ao clicar nele, o mesmo é baixado:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem3.png" alt="Download do arquivo save.zip" class="centered-image" />
</div>

<p>Ao analisar seu tipo através do comando <strong>file</strong>, foi possível confirmar como sendo um zip. Ao tentar descompactar o arquivo, uma senha é solicitada, e também é possível ver que os arquivos compactados aparentemente se referem a um sistema linux:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem4.png" alt="Manipulação do arquivo zip" class="centered-image" />
</div>

<h2 id="exploração-e-acesso-inicial">
  Exploração e acesso inicial
  <a class="heading-link" href="#explora%c3%a7%c3%a3o-e-acesso-inicial">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Para tentar quebrar esta senha, será utilizada a ferramenta <strong>zip2john</strong>, que faz parte da ferramenta <a href="https://www.openwall.com/john/"  class="external-link" target="_blank" rel="noopener">John the Ripper</a>.</p>
<p><strong>Comando:</strong> <code>zip2john save.zip &gt; hash</code></p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem5.png" alt="Geração da hash do zip" class="centered-image" />
</div>

<p>Como resultado, a seguinte hash é gerada:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem6.png" alt="Hash gerada" class="centered-image" />
</div>

<p>Na sequência, rodei a ferramenta <strong>john</strong> utilizando a wordlist <a href="https://www.keepersecurity.com/blog/pt-br/2023/08/04/understanding-rockyou-txt-a-tool-for-security-and-a-weapon-for-hackers/"  class="external-link" target="_blank" rel="noopener">rockyou.txt</a> através do parâmetro <strong>--wordlist</strong>, juntamente com o arquivo de hash gerado anteriormente:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem7.png" alt="Processo de cracking da hash" class="centered-image" />
</div>

<p>Em posse da senha, foi possível fazer a descompactação do arquivo:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem8.png" alt="Descompactação do zip" class="centered-image" />
</div>

<p>Ao analisar o arquivo <strong>passwd</strong>, foi possível identificar o usuário <strong>296640a3b825115a47b68fc44501c828</strong>:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem9.png" alt="Visualização do arquivo /etc/passwd" class="centered-image" />
</div>

<p>Ao analisar o arquivo <strong>shadow</strong>, foi possível identificar tanto a hash do usuário <strong>296640a3b825115a47b68fc44501c828</strong>, quanto do usuário <strong>root</strong>:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem10.png" alt="Visualização do arquivo /etc/shadow" class="centered-image" />
</div>

<p>Em posse da entrada de <strong>passwd</strong> e <strong>shadow</strong> do usuário, utilizei a ferramenta <strong>unshadow</strong> (também presente ao instalar o John) para concatenar ambas:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem11.png" alt="Processo de unshadow dos arquivos" class="centered-image" />
</div>

<p>Após um processo de sanitização no arquivo, deixando as entradas para os usuários <strong>296640a3b825115a47b68fc44501c828</strong> e <strong>root</strong>, rodei a ferramenta <a href="https://hashcat.net/hashcat/"  class="external-link" target="_blank" rel="noopener">hashcat</a>.</p>
<p><strong>Comando:</strong> <code>hashcat -m 1800 unshadow /usr/share/wordlists/rockyou.txt --show</code></p>
<p><strong>Parâmetros:</strong></p>
<ul>
<li><strong>-m</strong> modo da hash, utilizado para definir o tipo de hash que que será ingerida, nesse caso, sha512crypt (unix);</li>
<li><strong>&ndash;show</strong> usado para mostrar as hashes que foram quebradas.</li>
</ul>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem12.png" alt="Processo de unshadow dos arquivos" class="centered-image" />
</div>

<p>Como resultado do processo de cracking, foi possível identificar a senha para o usuário <strong>296640a3b825115a47b68fc44501c828</strong>.</p>
<p>Como existe um serviço SSH rodando, efetuei a conexão à máquina através deste serviço:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem13.png" alt="Acesso via SSH" class="centered-image" />
</div>

<p>Como o usuário <strong>296640a3b825115a47b68fc44501c828</strong> recebeu uma shell limitada do tipo <strong>rbash</strong>, efetuei o processo de &ldquo;breakeout&rdquo; dessa shell através da definição de um terminal junto à conexão SSH.
Passando o parâmetro <strong>-t</strong> e o binário <strong>bash</strong> foi possível realizar o bypass:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem14.0.png" alt="Acesso via SSH com breakout" class="centered-image" />
</div>

<p>Ao tentar ler um arquivo, foi notado que o comando <strong>cat</strong> não estava disponível, justificado pela falta do caminho (path) do binário na variável de ambiente <strong>PATH</strong>:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem14.1.png" alt="Validação de PATH" class="centered-image" />
</div>

<p>Para corrigir, executei o comando abaixo, que adiciona os caminhos de binários mais comuns à variavel PATH:</p>
<p><strong>Comando:</strong> <code>export PATH=$PATH:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem14.2.png" alt="Rbash brakeout" class="centered-image" />
</div>

<p>Uma vez com acesso à máquina e com uma shell que fornece acesso aos principais binários, iniciei o processo de análise manual do sistema de arquivos em busca de artefatos que possam contribuir com a minha exploração.</p>
<p>Dentro do diretório <strong>/home/296640a3b825115a47b68fc44501c828</strong> foi possível localizar o arquivo <strong>user.txt</strong>, contendo a flag de usuário:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem15.png" alt="Visualização da flag de usuário" class="centered-image" />
</div>

<h2 id="escalonamento-de-privilégios">
  Escalonamento de Privilégios
  <a class="heading-link" href="#escalonamento-de-privil%c3%a9gios">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Ainda dentro da pasta do usuário, foi possível notar um binário chamado <strong>honeypot.decoy</strong>, ao rodar o mesmo, a opção 5 chamou a atenção pelo seu comportamento, que indica que um scan de Antivirus será iniciado m um minuto ou menos:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem15.1.png" alt="Execução do binário honeypot.decoy" class="centered-image" />
</div>

<p>Após executá-lo, aparentemente nada aconteceu, porém, ao analisar os processos da máquina através da ferramenta <a href="https://github.com/DominicBreuker/pspy"  class="external-link" target="_blank" rel="noopener">pspy</a>, que possibilita o usuário &lsquo;bisbilhotar&rsquo; os processos sem a necessidade de root, foi possível notar a execução de um programa chamado <strong>chkrootkit</strong>:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem16.png" alt="Visualização do processo de chkrootkit" class="centered-image" />
</div>

<p>Ao pesquisar na internet sobre o Chkrootkit na versão 0.49, foi possível identificar a possibilidade de executar um escalonamento de privilégios local, conforme indicado nessa <a href="https://www.exploit-db.com/exploits/33899"  class="external-link" target="_blank" rel="noopener">documentação</a>.</p>
<p>Conforme indicado no link, se um atacante sabe da execução constante do chkrootkit, seja por meio de um cronjob, seja por meio de outro script, e o atacante tem acesso à pasta temporária <strong>/tmp</strong>, ele pode utilizar da falha existente para executar um arquivo denominado <strong>update</strong> como root:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem17.png" alt="Explicação do processo de exploração" class="centered-image" />
</div>

<p>Para explorar, criei um arquivo com o nome <strong>update</strong> contendo uma shell reversa e um listener de netcat:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem18.png" alt="Criação da reverse shell" class="centered-image" />
</div>

<p>Após esperar um minuto, recebi uma conexão como usuário <strong>root</strong>:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem19.png" alt="Shell de root" class="centered-image" />
</div>

<p>Dentro do diretório <strong>/root</strong> foi ppossível localizar o arquivo <strong>proof.txt</strong>, contendo a flag de root:</p>
<div style="text-align: center;">
  <img src="/pg-sunsetdecoy/imagem20.png" alt="Flag de Root" class="centered-image" />
</div>

<h2 id="conclusão">
  Conclusão
  <a class="heading-link" href="#conclus%c3%a3o">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>O desafio <strong>SunsetDecoy</strong> foi relativamente simples, mas destaco alguns pontos de atenção:</p>
<ul>
<li>A parte de exportar um novo valor para a variável de ambiente PATH foi algo novo para mim, sendo uma técnica muito interessante de se ter em seu arsenal de &ldquo;guerra&rdquo;;</li>
<li>Na parte de escalonamento de privilégios, ficou evidenciada a importância de sempre testar/validar as descobertas, pois somente através da execução da opção 5 do binário <strong>honeypot.decoy</strong> é que foi possível identificar a execução do <strong>chkrootkit</strong>.</li>
</ul>

      </div>


      <footer>
        


        
        
        
        
        

        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
     Eduardo Borges 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  
  



  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
